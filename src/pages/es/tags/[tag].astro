---
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import PostCard from '../../../components/PostCard.astro';
import { useTranslations } from '../../../i18n/utils';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog', ({ data }) => data.language === 'es');
  const allTags = [...new Set(allPosts.flatMap(post => post.data.tags))];
  
  return allTags.map(tag => ({
    params: { tag },
    props: {
      posts: allPosts
        .filter(post => post.data.tags.includes(tag) && !post.data.draft)
        .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    }
  }));
}

const { tag } = Astro.params;
const { posts } = Astro.props;

const lang = 'es';
const t = useTranslations(lang);
---

<Layout 
  title={`${t('tags.postsTaggedWith')}: ${tag} - ${t('site.title')}`}
  description={`${t('tags.postsTaggedWith')} ${tag}`}
>
  <div class="tag-page">
    <header class="page-header">
      <a href="/es/tags" class="back-link">‚Üê {t('tags.title')}</a>
      <h1>{t('tags.postsTaggedWith')}: <span class="tag-highlight">{tag}</span></h1>
      <p>{posts.length} {posts.length === 1 ? 'post' : 'posts'}</p>
    </header>
    
    <div class="posts-grid">
      {posts.map((post: any) => (
        <PostCard post={post} />
      ))}
    </div>
  </div>
</Layout>

<style>
  .tag-page {
    max-width: 1200px;
    margin: 0 auto;
  }
  
  .page-header {
    text-align: center;
    margin-bottom: 3rem;
  }
  
  .back-link {
    display: inline-block;
    margin-bottom: 1rem;
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 500;
  }
  
  .back-link:hover {
    text-decoration: underline;
  }
  
  .page-header h1 {
    margin-bottom: 0.5rem;
  }
  
  .tag-highlight {
    color: var(--color-primary);
    text-transform: capitalize;
  }
  
  .page-header p {
    color: var(--color-text-light);
  }
  
  .posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
  }
  
  @media (max-width: 768px) {
    .posts-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }
</style>
